
## 1. ภาพรวมโครงการ (Project Overview)

Agri-Tech Marketplace คือแพลตฟอร์ม E-Commerce ที่ถูกสร้างขึ้นเพื่อเป็นตลาดกลางสำหรับซื้อ-ขายอุปกรณ์การเกษตรสมัยใหม่ เช่น โดรนเพื่อการเกษตร, เซ็นเซอร์ IoT, และเครื่องมือไฮเทคต่างๆ โดยมีกลุ่มผู้ใช้งานหลัก 3 กลุ่มคือ:

1.  **ผู้ซื้อ (Buyer):** เกษตรกร, นักศึกษา, หรือบุคคลทั่วไปที่สนใจเทคโนโลยีการเกษตร
2.  **ผู้ขาย (Seller):** ร้านค้าหรือบุคคลที่ต้องการนำสินค้ามาลงขายบนแพลตฟอร์ม
3.  **ผู้ดูแลระบบ (Admin):** ผู้พัฒนาระบบที่ทำหน้าที่อนุมัติผู้ขายและจัดการข้อมูลหลัก

โครงการนี้ถูกพัฒนาขึ้นเพื่อเป็นโครงงานจบการศึกษา โดยมุ่งเน้นการใช้เทคโนโลยีเว็บสมัยใหม่เพื่อสร้างแอปพลิเคชันที่มีประสิทธิภาพ, ปลอดภัย, และสามารถต่อยอดได้ในอนาคต

## 2. สถาปัตยกรรมและเทคโนโลยี (Architecture & Tech Stack)

เราเลือกใช้สถาปัตยกรรมแบบ **Full-Stack Monolith** โดยมี Next.js เป็นแกนกลาง และใช้ Supabase เป็น Backend as a Service (BaaS) เพื่อลดความซับซ้อนและเร่งกระบวนการพัฒนา

### System Architecture Diagram

```
┌──────────────────────────┐      ┌──────────────────────────┐
│      User's Browser      │      │     Developer/Admin      │
└─────────────┬────────────┘      └─────────────┬────────────┘
              │                                 │
              │ HTTPS                           │ Direct Access
              ▼                                 ▼
┌─────────────────────────────────────────────────────────────┐
│                 Application Server (Vercel)                 │
├─────────────────────────────────────────────────────────────┤
│                 Next.js (Full-Stack Framework)              │
│  ┌─────────────────────────┬──────────────────────────────┐ │
│  │   Frontend (App Router) │     Backend (API Routes)     │ │
│  │ - React Components      │ - Business Logic             │ │
│  │ - State (Context API)   │ - Data Validation (Zod)      │ │
│  │ - UI (Tailwind CSS)     │ - User Session Management    │ │
│  └─────────────────────────┴──────────────────────────────┘ │
└─────────────────────────────┬───────────────────────────────┘
                              │
                              │ Supabase JS Client (HTTPS/REST)
                              ▼
┌─────────────────────────────────────────────────────────────┐
│              Backend as a Service (Supabase)                │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────────┐  ┌──────────────┐  ┌────────┐│
│ │   Auth   │  │  PostgreSQL  │  │   Storage    │  │  Edge  ││
│ │(Logins)  │  │(Database+RLS)│  │(Image Files) │  │(Functions)│
│ └──────────┘  └──────────────┘  └──────────────┘  └────────┘│
└─────────────────────────────────────────────────────────────┘
```

+--------------------------------+       +--------------------------------+       +--------------------------------+
|          ผู้ซื้อ (Buyer)         |       |         ผู้ขาย (Seller)         |       |      ผู้ดูแลระบบ (Admin)        |
|      (Web Browser/Mobile)      |       |        (Web Browser)         |       |     (Web Browser/Supabase UI)    |
+---------------+----------------+       +---------------+----------------+       +---------------+----------------+
                |                                |                                |
                |                                |                                |
                +--------------------------------+--------------------------------+
                                                 |
                                         HTTPS / WebSocket
                                                 |
                                                 ▼
+----------------------------------------------------------------------------------------------------+
|                                    Deployment Platform (Vercel)                                    |
|----------------------------------------------------------------------------------------------------|
|                                                                                                    |
|  +----------------------------------------------------------------------------------------------+  |
|  |                                  Next.js Application                                          |  |
|  |----------------------------------------------------------------------------------------------|  |
|  |                                                                                              |  |
|  | +-----------------------------+  +-------------------------------+  +-----------------------+ |  |
|  | |   Presentation Layer        |  |     Business Logic Layer      |  |   Data Access Layer   | |  |
|  | |    (React Components)       |  |      (API Routes / Server     |  | (Supabase JS Client)  | |  |
|  | | - Pages (App Router)        |  |           Actions)            |  | - Client Component    | |  |
|  | | - UI Components (Tailwind)  |  | - Authentication Checks       |  | - Server Component    | |  |
|  | | - State (Context API)       |  | - Data Validation (Zod)       |  | - API Route Client    | |  |
|  | | - User Input Handling       |  | - Calling External Services   |  | - Admin Client        | |  |
|  | +--------------+--------------+  +---------------+---------------+  +-----------+-----------+ |  |
|  +----------------|--------------------------------|-----------------------------|-------------+  |
|                   |                                |                             |                  |
|                   +--------------------------------+-----------------------------+
|                                                    |
|                                     HTTPS / RESTful API / RPC
|                                                    |
                                                     ▼
+----------------------------------------------------------------------------------------------------+
|                                Backend as a Service Platform (Supabase)                            |
|----------------------------------------------------------------------------------------------------|
|                                                                                                    |
|  +---------------------------------------------+  +----------------------------------------------+  |
|  |            Application Services             |  |                 Data Services                |  |
|  |---------------------------------------------|  |----------------------------------------------|  |
|  |                                             |  |                                              |  |
|  | +-----------+   +-----------+   +-----------+  |  |  +---------------------------------------+   |  |
|  | |   Auth    |   |  Storage  |   |   Edge    |  |  |  |        PostgreSQL Database            |   |  |
|  | | (GoTrue)  |   | (S3-like) |   | Functions |  |  |  |---------------------------------------|   |  |
|  | +-----+-----+   +-----+-----+   +-----+-----+  |  |  | +-------------+  +------------------+ |   |  |
|  |       |               |               |       |  |  | | Data Tables |  | Stored Functions | |   |  |
|  |       |               |               |       |  |  | | (Schema)    |  | (RPC)            | |   |  |
|  +-------|---------------+---------------+-------+  |  |  +------+------+  +--------+---------+ |   |  |
|          |                                          |  |         |                 |           |   |  |
|          +------------------------------------------+--+---------+-----------------+-----------+   |  |
|                                                    |                                               |  |
|                    +-------------------------------V-------------------------------+                 |  |
|                    |     Row Level Security (RLS) & Storage Policies             |                 |  |
|                    |               (The Ultimate Security Gate)                  |                 |  |
|                    +-------------------------------------------------------------+                 |  |
|                                                                                                    |  |
|                                                                                                    |  |
+----------------------------------------------------------------------------------------------------+



### Tech Stack หลัก

*   **Framework:** **Next.js (App Router)** - สำหรับสร้าง Full-Stack Web Application ที่มีประสิทธิภาพสูง
*   **ภาษา:** **JavaScript** - ภาษาหลักในการพัฒนา
*   **Runtime:** **Bun** - เพื่อความเร็วในการติดตั้ง, รัน, และทดสอบโปรเจกต์
*   **Backend & Database:** **Supabase** - บริการ BaaS ที่มีทั้ง PostgreSQL Database, Authentication, และ Storage ทำให้เราไม่ต้องสร้าง Backend เองจากศูนย์
*   **Styling:** **Tailwind CSS** - Utility-first CSS framework สำหรับการสร้าง UI ที่สวยงามและปรับแก้ได้ง่าย
*   **Deployment:** **Vercel** - แพลตฟอร์มสำหรับ Deploy โปรเจกต์ Next.js ที่ง่ายและมีประสิทธิภาพ

## 3. ฟีเจอร์หลัก (Key Features)

### สิ่งที่ทำแล้ว (Implemented)
*   **ระบบยืนยันตัวตน (Authentication):**
    *   สมัครสมาชิก (Register) และเข้าสู่ระบบ (Login) สำหรับผู้ใช้ทั่วไป
    *   จัดการ Session ของผู้ใช้ทั่วทั้งแอปพลิเคชัน
*   **ระบบจัดการสินค้า (Product Management):**
    *   ผู้ขายสามารถเพิ่มสินค้าใหม่เข้าร้านของตนเองได้ (Create)
    *   มีการอัปโหลดรูปภาพสินค้าไปจัดเก็บบน Supabase Storage
    *   ผู้ใช้ทั่วไปสามารถดูรายการสินค้าทั้งหมดได้ (Read)
*   **ความปลอดภัย (Security):**
    *   บังคับใช้สิทธิ์การเข้าถึงข้อมูลในระดับฐานข้อมูลด้วย **Row Level Security (RLS)**
    *   มีการป้องกันการเข้าถึง API ที่ไม่ได้รับอนุญาต
    *   กำหนด Hostname ที่อนุญาตสำหรับรูปภาพใน Next.js เพื่อป้องกัน XSS

### สิ่งที่กำลังจะทำ (Roadmap)
*   ฟังก์ชันสำหรับผู้ซื้อ: ตะกร้าสินค้า, การสั่งซื้อ (จำลอง), การรีวิวสินค้า
*   ฟังก์ชันสำหรับผู้ขาย: Dashboard, การจัดการออเดอร์, การจัดการสต็อก
*   ฟังก์ชันสำหรับผู้ดูแลระบบ: การอนุมัติผู้ขาย, การจัดการหมวดหมู่สินค้า

## 4. วิธีการติดตั้งและรันโปรเจกต์ (Setup & Run)

### Prerequisites
*   [Bun](https://bun.sh/) ติดตั้งอยู่บนเครื่อง
*   Account ของ [Supabase](https://supabase.com/)

### ขั้นตอนการติดตั้ง
1.  **Clone a project**
    ```bash
    git clone [URL ของโปรเจกต์คุณ]
    cd agri-tech-marketplace
    ```
2.  **ติดตั้ง Dependencies**
    ```bash
    bun install
    ```
3.  **ตั้งค่า Environment Variables**
    *   สร้างไฟล์ `.env.local` ที่ Root ของโปรเจกต์
    *   คัดลอกเนื้อหาจากไฟล์ `.env.example` (ถ้ามี) หรือใส่ค่าตัวแปรตามนี้:
        ```env
        NEXT_PUBLIC_SUPABASE_URL="YOUR_SUPABASE_URL"
        NEXT_PUBLIC_SUPABASE_ANON_KEY="YOUR_SUPABASE_ANON_KEY"
        SUPABASE_SERVICE_ROLE_KEY="YOUR_SERVICE_ROLE_KEY"
        ```
    *   *สามารถหาค่าเหล่านี้ได้จาก Dashboard ของ Supabase ที่เมนู `Settings` > `API`*

4.  **ตั้งค่า Database Schema & RLS**
    *   ไปที่ **SQL Editor** ใน Supabase Dashboard
    *   รันไฟล์ SQL ที่อยู่ในโฟลเดอร์ `supabase/schema.sql` (คุณต้องสร้างไฟล์นี้ขึ้นมาเองโดยรวบรวมคำสั่ง SQL ที่เราใช้ไป) เพื่อสร้างตารางและ RLS Policies ทั้งหมด

5.  **ตั้งค่า Supabase Storage**
    *   ไปที่ `Storage` และสร้าง Bucket ชื่อ `product-images`
    *   ตั้งค่า Policies สำหรับการเข้าถึงไฟล์ตามที่กำหนดไว้ใน SQL

6.  **รัน Development Server**
    ```bash
    bun dev
    ```
    แอปพลิเคชันจะพร้อมใช้งานที่ `http://localhost:3000`

## 5. การตัดสินใจทางสถาปัตยกรรมที่สำคัญ (Key Architectural Decisions)

*   **เลือกใช้ Supabase แทนการสร้าง Backend เอง:** เพื่อลดเวลาในการพัฒนาและใช้ประโยชน์จากฟีเจอร์ความปลอดภัยในตัวอย่าง RLS ซึ่งแข็งแกร่งและป้องกันข้อมูลรั่วไหลได้ดีมาก
*   **ใช้ PostgreSQL Function (RPC) สำหรับ Atomic Operations:** ในการสร้างสินค้า มีการบันทึกข้อมูล 2 ตารางพร้อมกัน (products, product_images) เราจึงใช้ RPC เพื่อให้แน่ใจว่าการดำเนินการทั้งหมดจะสำเร็จหรือล้มเหลวไปพร้อมกัน (Transaction) ป้องกันข้อมูลที่ไม่สมบูรณ์
*   **Authorization ที่ระดับ Database (RLS):** แทนที่จะเขียน Logic การเช็คสิทธิ์ในโค้ด API เพียงอย่างเดียว เราผลักภาระนี้ไปให้ Database จัดการ ซึ่งเป็นปราการด่านสุดท้ายที่ปลอดภัยที่สุด

